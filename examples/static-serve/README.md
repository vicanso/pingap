# static serve

静态文件服务，使用`cache`与`compression`插件，为静态文件服务极高效的压缩与缓存服务。


## http static file server

```bash
docker run -d --restart=always \
  -e STATIC_COMPRESS_MIN_LENGTH=0 \
  -p 8080:3000 \
  --name static \
  -v ~/Downloads:/static:ro \
  vicanso/static
```

## start pingap

```bash
pingap -c ~/github/pingap/examples/static-serve --admin=127.0.0.1:3018
```

## 核心优点

1.【极致效率】懒加载式缓存，杜绝任何资源浪费:
  - 优先级队列: 服务器内部设定了明确的压缩算法优先级：Zstandard > Brotli > Gzip
  - 零预热成本: 无需在服务启动或文件上传时预先处理所有文件。服务器在第一个请求到达时才开始工作，部署和更新速度极快。
  - 最小化 `CPU` 开销: “按需压缩”确保了 `CPU` 只为实际发生的请求服务，避免了为支持老旧浏览器而预先生成 `gzip` 版本等低效操作。
  - 节省存储空间: 对于拥有海量文件（如图库、文档库）的系统，这种策略可以节省大量的磁盘空间，因为只有被请求过的文件才会被压缩和缓存。

2.【智能自适应】自动为每个客户端提供最优版本:
  - 该设计确保了无论是使用最新还是老旧浏览器的用户，都能在服务器能力范围内，自动获得其所支持的最佳压缩格式，实现了性能和兼容性的完美平衡。

3.【性能与成本】继承“一次压缩”的所有优点，并将其升华:
  - 在“一次压缩，N次使用”的基础上，通过“懒加载”机制，将“一次压缩”的动作推迟到真正需要它的那一刻，使得整个方案的资源利用率达到了理论上的最优解，同时保留了超低 `TTFB` 和高并发下的稳定 `CPU` 表现。

## 应用场景

这个特性让它在某些场景下，优势被无限放大：

1. 拥有海量、长尾静态资源的网站 (如素材库、文档站、大型博客)
  - 场景描述: 网站拥有数百万个文件，但大部分文件访问频率很低（长尾效应）。
  - `pingap` 优势: 预压缩所有文件是不可行的，会消耗惊人的时间和空间。`pingap` 的“懒加载”机制是这类场景的完美解决方案，它只为热门文件创建缓存，对冷门文件则完全不产生额外开销，极大降低了运营成本。

2. CDN 回源服务器 (更深层次的优势)
  - `pingap` 优势: 这种机制可以完美适配 CDN 的行为。如果您的 CDN 配置只会回源请求 `br` 和 `gzip` 压缩，那么 `pingap` 源站就永远不会浪费 `CPU` 去生成 `zstd` 版本。源站能够智能地“学习”并适应前端 `CDN` 的请求模式，非常高效。
